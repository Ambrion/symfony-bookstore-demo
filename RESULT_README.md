# Тестовое задание Symfony

* **Для реализации использовал БД - MySql**
* **Версия PHP 8.3**

## Реализовано:
1. Админ панель (использовал easyadmin)
2. Авторизация
3. Форма обратной связи с ReCAPTCHA и обработкой сообщений через очереди
4. Парсинг книг с файла json с различными параметрами и блокировкой процесса
5. Категории книг
6. Детальный просмотр книги
7. Поиск книг по названию, автору, статусу
8. Фильтр книг по двум параметрам. Например, по Автору и Названию

### 1. Реализация настроек
Базовые настройки находятся в файле `.env`, база указана там же для докер контейнера. В файле `config/services.yaml` преобразовываются для системы в разделе `parameters`.

Чтобы управлять из админки конкретными настройками и перезаписывать базовые создан раздел "Настройки".
Возьмите название настройки из `config/services.yaml` раздела `parameters` и сохраните с нужным значением в форме создания/редактирования настройки.
Например, название `app.item_per_page_book_list` с параметром `10` будет отображать кол-во элементов на странице просмотра списка книг.
После комментария "#Не перезаписываются в БД:" настройки не работают через перезапись в БД.

### 2. Авторизация
Реализована штатными средствами symfony. Доступ и пользователь создаётся при запуске миграции.

### 3. Форма обратной связи
Использована гугл **ReCAPTCHA** v3. Необходимо подключить в админ панеле ReCAPTCHA домен и прописать ключи в настройках приложения в параметрах `RECAPTCHA3_KEY` и `RECAPTCHA3_SECRET`.
Для просмотра и отправки Email-сообщений используется докер контейнер и образ **axllent/mailpit**. 
После запуска нужно посмотреть порты на которых будет работать панель, например, командой `docker ps` и зайти по URL в браузере.
Отправленные сообщения можно просмотреть в Админ панеле в разделе "Обратная связь".

После создания сообщения оно попадает в очередь и отправляется от туда. Очередь хранится в БД используя транспорт doctrine.

### 4. Реализация парсера и импорта книг
Исхожу из того что файл по URL имеет такой размер, который без проблем может быть взят и сохранён на локальный диск сервера за раз без обрывов и т.д.

##### Команда запускающая парсер и импорт:
* `php bin/console app:import-book-from-url`

##### Помощь для просмотра возможностей импорта:
* `php bin/console app:import-book-from-url --help`

##### Аргументы импорта:
* Не обязательный аргумент `url` используется для передачи URL в обход стандартных конфига и данных конфига сохраненных в БД.
* Пример: `php bin/console app:import-book-from-url http://mysite.name/import.json`

##### Опции (все не обязательные):
* `format` - позволяет ввести формат файла импорта с URL, тип "строка". На данный момент доступен только формат: `json`.
* Пример: `php bin/console app:import-book-from-url --format=json`
* `getBooks` - позволяет ввести кол-во получаемых книг, тип "целое число".
* Пример: `php bin/console app:import-book-from-url --getBooks=10`
* `batchSize` - позволяет указать размер очереди перед сохранением книг, тип "целое число".
* Пример: `php bin/console app:import-book-from-url --batchSize=20`
* `baseCategory` - позволяет установить название базовой категории для книг у которых не указана категория, тип "строка".
* Пример: `php bin/console app:import-book-from-url --baseCategory=Новинки`.
* `dryRun` - позволяет запустить парсинг без добавления в базу, тип "булевый".
* Пример: `php bin/console app:import-book-from-url --dryRun`

##### Что происходит при парсинге и импорте
* Когда не указываем URL для парсинга, то берётся локальный файл лежащий в `/public/books.json`
* Один из вариантов: сохраняем файл импорта на диск и дальше работаем с локальной копией, после успешного импорта копия удаляется.
* Предварительная обработка категорий и авторов - обработка неявных дубликатов (Microsoft .NET, Microsoft.NET, Microsoft/ .NET), после получения очищенных данных берутся данные из БД и сравниваются с пришедшими данными. Когда появляются новые категории или авторы, то добавляем только новых.
* Входящие данные должны проверяться на возможные ограничения системы, например, на наличие обязательных полей. Пока считаю что уникальным является ISBN и ищу по нему, а так же не пускаю к созданию книги без названия.
* Импорт происходит с показанием прогресса в консоли.

### 5. Реализация категории книг
На главной странице сайта выводятся категории только верхнего уровня.
Когда у категории есть подкатегории, то при переходе в категорию, выводятся её под-категории.
Когда у категории нет подкатегорий, есть только книги, выводить книги. С учетом пагинации.
Книги из под-категорий категории также выводятся на странице категории с учетом пагинации.

### 6. Реализация детального просмотра книги
В детальном просмотре отображаются:
* Изображение книги
* Название книги
* Категории в которой находится книга (кликабельны)
* Кол-во страниц
* isbn номер как артикул
* Короткое описание книги
* Книги из текущей категории(если имеются такие, кол-во настраивается)

### 7. Реализован поиск книг по названию, автору, статусу
В категориях реализовать фильтр по:
* Названию книги (название содержит)
* Автор (название содержит)
* Статусу (select)

### 8. Реализован фильтр книг по двум и более параметрам
* Можно искать по названию, автору, статусу
